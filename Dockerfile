FROM alpine:3.4
MAINTAINER Joeri van Dooren <ure@mororless.be>

#perl-net-ssleay perl-clone perl-package-stash perl-package-stash-xs perl-lwp-useragent-determined perl-data-uuid perl-datetime perl-file-rsync perl-mime-tools perl-yaml-xs perl-extutils-cchecker perl-extutils-helpers perl-extutils-config perl-extutils-installpaths  perl-yaml-xs perl-yaml-syck perl-json perl-exporter perl-data-uuid perl-time-hires perl-time-date perl-datetime-timezone perl-file-slurp perl-params-validate perl-xml-sax perl-test-deep perl-test-leaktrace perl-test-sharedfork perl-test-tcp

RUN apk update && apk add tzdata bash tar rsync  \
perl perl-dev gcc musl-dev libxml2 libxml2-dev make wget curl git vim redis perl-test-tcp-2.14-r0 perl-http-body-1.17-r0 perl-log-dispatch-2.51-r0 perl-net-async-http-0.40-r0 perl-net-libidn-0.12-r1 perl-compress-raw-zlib-2.069-r2 perl-hash-multivalue-0.08-r0 perl-devel-symdump-2.15-r0 perl-want-0.26-r0 perl-gdtextutil-0.86-r0 perl-role-basic-0.13-r0 perl-sub-name-0.15-r0 perl-cgi-emulate-psgi-0.21-r0 perl-socket-getaddrinfo-0.20-r2 perl-subversion-1.9.4-r0 perl-xml-simple-2.22-r0 perl-plack-1.0033-r0 perl-file-sharedir-install-0.09-r0 perl-file-temp-0.2302-r0 perl-test-output-1.03-r0 perl-datetime-format-mail-0.3001-r0 perl-canary-stability-2006-r0 perl-html-mason-psgihandler-0.53-r0 perl-exception-class-1.40-r0 perl-uri-1.71-r0 perl-file-tail-1.3-r0 perl-libwww-6.08-r0 perl-text-csv-1.20-r1 perl-x10-0.03-r2 perl-text-wikiformat-0.81-r0 perl-digest-hmac-1.03-r0 perl-test-tester-0.109-r0 perl-file-next-1.12-r0 perl-git-svn-2.8.3-r0 perl-sub-uplevel-0.25-r0 perl-socket6-0.25-r2 perl-netaddr-ip-4.078-r0 perl-data-ical-0.21-r0 perl-crypt-openssl-random-0.10-r1 perl-dbix-dbschema-0.39-r0 perl-astro-suntime-0.01-r2 perl-async-mergepoint-0.04-r0 perl-business-hours-0.12-r0 perl-html-format-2.11-r0 perl-html-mason-1.54-r0 perl-rt-authen-externalauth-0.25-r0 perl-scope-upper-0.28-r0 perl-net-telnet-3.04-r0 perl-font-afm-1.20-r0 perl-pathtools-3.62-r0 perl-class-container-0.12-r1 perl-convert-color-0.11-r0 perl-posix-strftime-compiler-0.41-r0 perl-math-round-0.07-r0 perl-test-refcount-0.08-r0 perl-test-number-delta-1.06-r0 perl-sub-exporter-0.987-r0 perl-cpan-meta-check-0.011-r0 perl-module-versions-report-1.06-r0 perl-net-openssh-0.70-r0 perl-mime-base64-3.15-r1 perl-http-cookies-6.01-r0 perl-convert-tnef-0.17-r2 perl-try-tiny-0.22-r0 perl-regexp-ipv6-0.03-r0 perl-dbd-pg-3.5.3-r0 perl-encode-hanextra-0.23-r0 perl-net-rblclient-0.5-r2 perl-module-util-1.09-r0 perl-params-util-1.07-r3 perl-test-warnings-0.026-r0 perl-getopt-long-2.48-r0 perl-parallel-prefork-0.14-r0 perl-package-anon-0.05-r2 perl-b-hooks-endofscope-0.15-r0 perl-css-squish-0.10-r0 perl-exporter-tiny-0.042-r0 perl-html-rewriteattributes-0.05-r0 perl-crypt-openssl-rsa-0.28-r4 perl-time-hires-1.9726-r1 perl-regexp-common-net-cidr-0.02-r0 perl-list-allutils-0.09-r0 perl-file-sharedir-1.102-r0 perl-lwp-useragent-determined-1.07-r0 perl-sys-hostname-long-1.5-r0 perl-config-grammar-1.10-r0 perl-javascript-minifier-xs-0.11-r1 perl-xml-rss-1.56-r0 perl-io-async-0.69-r0 perl-heap-0.80-r0 perl-module-metadata-1.000027-r0 perl-text-password-pronounceable-0.30-r0 perl-error-0.17024-r0 perl-archive-zip-1.57-r0 perl-html-formattext-withlinks-0.14-r1 perl-snmp-session-1.13-r2 perl-ldap-0.65-r0 perl-convert-binhex-1.123-r0 perl-net-snpp-1.17-r2 perl-test-nowarnings-1.04-r0 perl-class-inspector-1.28-r0 perl-test-exception-0.43-r0 perl-datetime-locale-0.45-r0 perl-net-server-2.008-r0 perl-html-formattext-withlinks-andtables-0.06-r0 perl-digest-md5-2.54-r1 perl-test-harness-3.36-r0 perl-extutils-helpers-0.022-r0 perl-test-pod-1.51-r0 perl-cps-0.18-r0 perl-datetime-format-natural-1.02-r0 perl-digest-sha1-2.13-r7 perl-xml-namespacesupport-1.11-r1 perl-test-identity-0.01-r0 perl-cgi-session-4.48-r0 perl-io-1.25-r1 perl-module-pluggable-5.2-r0 perl-clone-0.38-r0 perl-params-classify-0.013-r4 perl-email-date-format-1.005-r0 perl-http-negotiate-6.01-r0 perl-data-page-pageset-1.02-r1 perl-git-2.8.3-r0 perl-net-http-6.09-r0 perl-db_file-1.827-r4 perl-variable-magic-0.59-r0 perl-lwp-mediatypes-6.02-r0 perl-net-ssleay-1.72-r0 perl-devel-stacktrace-2.00-r0 perl-xml-parser-2.44-r1 perl-inline-c-0.75-r0 perl-extutils-cchecker-0.09-r0 perl-net-smtp-ssl-1.03-r0 perl-locale-maketext-lexicon-1.00-r0 perl-fcgi-procmanager-0.19-r0 perl-class-load-0.23-r0 perl-package-deprecationmanager-0.15-r0 perl-namespace-clean-0.27-r0 perl-authen-sasl-2.16-r0 perl-compress-raw-bzip2-2.035-r8 perl-dbix-searchbuilder-1.65-r0 perl-encode-piconv-2.76-r0 perl-module-runtime-0.014-r1 perl-test-sharedfork-0.34-r0 perl-inline-0.80-r0 perl-html-tree-5.03-r0 perl-ipc-sharelite-0.17-r0 perl-rt-extension-commandbymail-0.17-r0 perl-devel-globaldestruction-0.13-r0 perl-test-warn-0.30-r0 perl-text-template-1.46-r0 perl-stream-buffered-0.02-r0 perl-dbd-odbc-1.52-r0 perl-file-listing-6.04-r0 perl-css-minifier-xs-0.09-r1 perl-universal-require-0.13-r0 perl-text-vfile-asdata-0.08-r0 perl-locale-maketext-fuzzy-0.11-r0 perl-params-validate-1.22-r0 perl-io-tty-1.12-r2 perl-net-cidr-0.17-r0 perl-date-extract-0.04-r0 perl-test-manifest-2.02-r0 perl-test-longstring-0.15-r0 perl-test-mocktime-0.15-r0 perl-test-requires-0.10-r0 perl-crypt-rijndael-1.11-r2 perl-class-accessor-lite-0.06-r0 perl-io-stringy-2.111-r0 perl-crypt-eksblowfish-0.009-r2 perl-5.22.2-r0 perl-carp-1.37.01-r0 perl-regexp-common-2016010801-r0 perl-module-refresh-0.17-r0 perl-http-message-6.11-r0 perl-probe-perl-0.03-r0 perl-dbd-sqlite-dev-1.48-r0 perl-ipc-system-simple-1.25-r0 perl-symbol-global-name-0.05-r0 perl-html-tagset-3.20-r0 perl-cgi-psgi-0.15-r0 perl-test-deep-1.120-r0 perl-date-calc-6.4-r0 perl-test-fatal-0.014-r0 perl-term-readkey-2.32-r2 perl-pod-coverage-0.23-r0 perl-html-quoted-0.03-r0 perl-parse-syslog-1.10-r2 perl-module-build-tiny-0.039-r0 perl-string-shellquote-1.04-r0 perl-dist-checkconflicts-0.11-r0 perl-mail-clamav-0.29-r10 perl-net-cidr-lite-0.21-r2 perl-class-accessor-chained-0.01-r0 perl-text-quoted-2.08-r0 perl-yaml-xs-0.59-r0 perl-image-exiftool-10.15-r0 perl-set-intspan-1.19-r0 perl-mail-domainkeys-1.0-r2 perl-class-mix-0.005-r0 perl-class-data-inheritable-0.08-r0 perl-rrd-1.5.5-r0 perl-encode-locale-1.05-r0 perl-io-multiplex-1.13-r0 perl-javascript-minifier-1.14-r0 perl-log-any-0.15-r0 perl-extutils-config-0.008-r0 perl-server-starter-0.15-r0 perl-test-inter-1.06-r0 perl-net-dns-resolver-programmable-0.003-r2 perl-struct-dumb-0.07-r0 perl-module-build-0.4218-r0 perl-mozilla-ca-20150826-r0 perl-data-page-2.02-r1 perl-email-address-list-0.05-r1 perl-xml-sax-0.99-r2 perl-cache-simple-timedexpiry-0.27-r0 perl-php-serialization-0.34-r1 perl-text-wrapper-1.04-r0 perl-net-dns-1.05-r0 perl-io-socket-ssl-2.021-r0 perl-mime-tools-5.506-r0 perl-sub-identify-0.12-r0 perl-text-reform-1.20-r0 perl-sub-exporter-progressive-0.001011-r0 perl-starlet-0.21-r0 perl-net-ldap-0.65-r0 perl-dev-5.22.2-r0 perl-http-date-6.02-r0 perl-cgi-fast-2.10-r0 perl-config-inifiles-2.88-r0 perl-test-pod-coverage-1.10-r0 perl-package-stash-xs-0.28-r2 perl-dbd-mysql-4.033-r0 perl-class-singleton-1.5-r0 perl-tree-dag_node-1.29-r0 perl-date-format-1.20-r2 perl-ipc-run3-0.048-r0 perl-mail-dkim-0.40-r0 perl-test-mockobject-1.20150527-r0 perl-crypt-ssleay-0.72-r2 perl-carp-clan-6.06-r0 perl-lwp-protocol-https-6.06-r0 perl-exporter-5.72-r0 perl-socket-2.019-r1 perl-json-2.90-r0 perl-time-date-1.20-r2 perl-list-utilsby-0.10-r0 perl-datetime-format-w3cdtf-0.06-r0 perl-convert-uulib-1.5-r0 perl-mail-spf-2.9.0-r2 perl-capture-tiny-0.36-r0 perl-apache-logformat-compiler-0.32-r0 perl-email-address-1.908-r0 perl-test-leaktrace-0.15-r1 perl-date-manip-6.53-r0 perl-cgi-4.28-r0 perl-text-autoformat-1.669004-r0 perl-boolean-0.45-r0 perl-dbd-sqlite-1.48-r0 perl-www-robotrules-6.02-r0 perl-net-snmp-6.0.1-r2 perl-text-soundex-3.04-r1 perl-crypt-des-2.07-r2 perl-devel-checkbin-0.02-r0 perl-switch-2.17-r0 perl-cache-cache-1.08-r0 perl-list-moreutils-0.415-r0 perl-file-rsync-0.70-r3 perl-datetime-1.25-r0 perl-extutils-installpaths-0.011-r0 perl-file-slurp-tiny-0.004-r0 perl-parse-recdescent-1.967013-r0 perl-data-uuid-1.219-r2 perl-fcgi-0.77-r1 perl-db-0.54-r3 perl-filesys-notify-simple-0.07-r0 perl-devel-stacktrace-ashtml-0.11-r0 perl-package-stash-0.37-r0 perl-file-slurp-9999.19-r0 perl-convert-asn1-0.27-r0 perl-file-which-1.21-r0 perl-class-accessor-0.34-r0 perl-device-serialport-1.04-r8 perl-encode-2.76-r0 perl-io-compress-2.069-r2 perl-http-daemon-6.01-r0 perl-mail-tools-2.14-r0 perl-proc-wait3-0.04-r4 perl-future-0.33-r0 perl-mail-imapclient-3.37-r0 perl-apache-session-1.93-r0 perl-gd-2.56-r0 perl-html-parser-3.71-r3 perl-class-returnvalue-0.55-r0 perl-data-optlist-0.110-r0 perl-html-scrubber-0.11-r0 perl-xml-sax-base-1.08-r1 perl-sub-install-0.928-r0 perl-scope-guard-0.21-r0 perl-unix-syslog-1.1-r7 perl-dbi-1.634-r0 perl-gdgraph-1.49-r0 perl-path-class-0.36-r0 perl-net-smtp-tls-butmaintained-0.24-r0 perl-sys-mmap-0.17-r1 perl-yaml-syck-1.29-r1 perl-test-script-1.10-r0 perl-control-x10-2.09-r1 perl-io-html-1.001-r0 perl-tree-simple-1.18-r1 perl-mime-lite-3.030-r0 perl-mail-spamassassin-3.4.1-r3 perl-net-ip-1.26-r0 perl-time-modules-2013.0912-r0 perl-data-guid-0.048-r0 perl-datetime-timezone-1.95-r0 perl-module-implementation-0.09-r0 perl-crypt-x509-0.51-r0 perl-mime-types-2.13-r0 && \
wget --no-check-certificate -O - http://cpanmin.us | perl - App::cpanminus && \
#rm -f /var/cache/apk/* && \
apk upgrade && \
#apk add tzdata && \
cp /usr/share/zoneinfo/Europe/Brussels /etc/localtime && \
echo "Europe/Brussels" >  /etc/timezone && \
#apk del tzdata && \
cpanm Data::Dumper JSON::XS ExtUtils::MakeMaker parent Perl::Critic Perl::Critic::Utils Test::Perl::Critic Sentry::Raven Mojolicious  Mojo::JSON Mojolicious::Plugin::RenderFile Mojolicious::Plugin::Sentry Data::GUID Time::Interval AnyEvent AnyEvent::DNS File::Basename Mojo::IOLoop AnyEvent::HTTP AnyEvent::HTTP::Request Config::YAML WebService::HipChat Data::Validate::URI XML::Loy JSON::Syck Modern::Perl Mojolicious::Plugin::YamlConfig boolean File::Sync WWW::Mailgun experimental && \
cpanm --force XML::LibXML XML::XML2JSON

# Redis::Fast (check)

# zbar
RUN apk add linux-headers imagemagick-dev jpeg-dev libjpeg jpeg libltdl libtool lcms2-dev fontconfig-dev freetype-dev && \
cd /tmp && \
wget http://downloads.sourceforge.net/project/zbar/zbar/0.10/zbar-0.10.tar.bz2 && \
bunzip2 -c zbar-0.10.tar.bz2 | tar xvf - && \
cd zbar-0.10 && \
./configure --disable-video --without-python --without-qt --without-gtk && \
make && make install && \
cpanm -f Barcode::ZBar

# Your app
ADD app/mojo.pl /app/mojo.pl

# Exposed Port
EXPOSE 3000

# VOLUME /app
WORKDIR /app

ENTRYPOINT ["/app/run.sh"]

# Set labels used in OpenShift to describe the builder images
LABEL io.k8s.description="Mojolicious" \
      io.k8s.display-name="mojolicious centos7 epel" \
      io.openshift.expose-services="3000:http" \
      io.openshift.tags="builder,mojolicious,perl" \
      io.openshift.min-memory="1Gi" \
      io.openshift.min-cpu="1" \
      io.openshift.non-scalable="false"
